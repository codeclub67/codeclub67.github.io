<html>
  <head>
    <style>
      .text { vertical-align: top; font-family: Sans-Serif }
      .top { vertical-align: top }
    </style>
  </head>
  <body>
    <section>
      <h2>Scratch newbie? start here:</h2>
      <ol>
        <li><a href="#scratch-first-steps">Scratch First Steps</a> - Move and turn a sprite.</li>
        <li><a href="#scratch-move">Scratch Move</a> - X and Y coordinates.</li>
        <li><a href="#scratch-talk">Scratch Talk</a> - Sprites can talk to each other.</li>
        <li><a href="#scratch-angle">Scratch Angle</a> - Learn about angles.</li>
        <li><a href="#scratch-eyes">Scratch Eyes</a> - Change the angle of a sprite.</li>
        <li><a href="#scratch-layers">Scratch Layers</a> - Use layers.</li>
        <li><a href="#scratch-aquarium">Scratch Aquarium</a> - Broadcast messages between sprites.</li>
      </ol>
    </section>
    <section>
      <h2>Pen extension (Logo graphics)</h2>
      <ol>
        <li><a href="#scratch-pen">Scratch Pen</a> - Draw simple shapes.</li>
      </ol>
    </section>
    <h2>The full list</h2>
    <section id="content">

    </section>
    <script>
      const OWNER = "codeclub67";
      const REPO = "codeclub67.github.io";
      var ht = null;
      var current = null;
      var doc = null;
      var img = null;
      var txt = null;

      async function getContents(owner, repo) {
        var url = `https://api.github.com/repos/${owner}/${repo}/contents/`;
        var response = await fetch(url);
        return response.json();
      }

      async function getTrees(owner, repo, sha) {
        var url = `https://api.github.com/repos/${owner}/${repo}/git/trees/${sha}`;
        var response = await fetch(url);
        return response.json();
      }

      function beginList() {
        ht = '<table>';
      }

      function output(id) {
        ht += `<tr id="${id}"><td class='text'><a href="${doc}">${doc}</a></td>`;
        if (img) ht += `<td class='top'><a href="${doc}"><img width='100px' src="${img}"></a></td>`;
        if (txt) ht += `<td class='text'><object data="${txt}"></object></td>`;
        ht += '</tr>';
      }

      function AddToList(item) {
        var s = item.split('.');
        var name = s[0];
        var ext = s[1];
        if (name==current) { // more files about the same thing
          if (ext=='png') img = item;
          else if (ext=='txt' || ext=='rtf') txt = item;
          else if (doc==null || ext=='pdf' || ext==null) doc = item;
        }
        else { // next file - emit the previous one
          if (doc) output(name);
          doc = null;
          img = null;
          txt = null;
          if (ext=='png') img = item;
          else if (ext=='txt' || ext=='rtf') txt = item;
          else if (ext=='docx' || ext=='pdf' || ext==null) doc = item;
          current = name;
        }
      }

      function endList() {
        // output the current file
        if (doc) output();
        ht += '</table>';
      }

      (async () => {
        var path=window.location.pathname.split('/');
        var n = path.length-1;
        if (path[n].endsWith(".html") || path[n]=="") n--;
        var dir = path[n];
        var contents = await getContents(OWNER,REPO);
        for (let file of contents) {
          if (file.name==dir) {
            var trees =  await getTrees(OWNER,REPO,file.sha);
            beginList();
            for (let file of trees.tree) {
              if (file.path == 'index.html') continue;
              AddToList(file.path);
            }
            endList() ;
            //document.getElementsByTagName('body')[0].innerHTML = ht;
            document.getElementById('content').innerHTML = ht;
            break;
          }
        }

      })()
    </script>
  <body>
</html>